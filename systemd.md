**Systemd** — это система инициализации и управления службами в Linux-системах. Она заменила традиционные init-системы, такие как SysVinit и Upstart, и стала стандартной системой инициализации в большинстве современных дистрибутивов Linux, включая Fedora, Debian, Ubuntu и Arch Linux.
Основные компоненты Systemd

Systemd состоит из нескольких ключевых компонентов:

- systemd: Основной процесс, управляющий всеми остальными компонентами.
- [unit files](#unit-files): Файлы конфигурации, определяющие службы, таймеры, сокеты и другие объекты.
- [journald](#Журналирование): Система ведения логов, которая собирает и хранит сообщения системных сервисов и приложений.
- [udevd](#udevd): Менеджер устройств, отвечающий за управление устройствами в системе.
- [logind](#logind): Сервис для управления сеансами пользователей и сидениями.
- [networkd](#networkd): Сервис для управления сетевыми интерфейсами.
- [resolved](#resolved): Сервис для разрешения доменных имен.

# Unit Files

**Unit файлы** — это конфигурационные файлы, которые определяют различные типы объектов, управляемых systemd. Эти файлы обычно находятся в директориях `/lib/systemd/system` и `/etc/systemd/system`. Вот некоторые примеры типов unit файлов:

- **Service**: Определяет сервис, который будет запущен и остановлен systemd.
- **Socket**: Определяет сокет, через который сервисы могут взаимодействовать друг с другом.
- **Timer**: Определяет периодическое выполнение задач.
- **Mount**: Определяет точку монтирования файловой системы.
- **Target**: Группирует другие unit файлы вместе для выполнения определенных действий.

Каждый unit файл имеет секцию `[Unit]`, где указывается описание и зависимости, а также секции, специфичные для типа unit файла. Например, у service unit файла есть секция `[Service]`, где определяются параметры запуска сервиса.

Пример простого service unit файла:

```
[Unit]
Description=My Example Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/myservice
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

## Управление службами

Для управления службами в systemd используются следующие команды:

- `systemctl start имя_службы` — запускает службу.
- `systemctl stop имя_службы` — останавливает службу.
- `systemctl restart имя_службы` — перезапускает службу.
- `systemctl status имя_службы` — показывает статус службы.
- `systemctl enable имя_службы` — добавляет службу в автозагрузку.
- `systemctl disable имя_службы` — удаляет службу из автозагрузки.

Например, чтобы запустить службу httpd и добавить ее в автозагрузку, выполните следующие команды:

```shell
sudo systemctl start httpd
sudo systemctl enable httpd
```

## Таймеры

Таймеры позволяют выполнять задачи периодически. Таймеры создаются путем создания **timer unit файла** и соответствующего service unit файла. Пример timer unit файла:

```
[Unit]
Description=My Example Timer

[Timer]
OnCalendar=*-*-* *:*:00
Persistent=true

[Install]
WantedBy=timers.target
```

Этот таймер будет запускать ассоциированную службу каждую минуту. Чтобы создать соответствующую службу, создайте service unit файл с тем же именем, но с расширением `.service`.

# Журналирование

Systemd предоставляет встроенную систему журналирования — `journald`. Для просмотра журналов можно использовать команду `journalctl`. Примеры использования:

- `journalctl` — просмотр всех сообщений журнала.
- `journalctl -u имя_службы` — просмотр сообщений журнала для конкретной службы.
- `journalctl -f` — мониторинг новых сообщений журнала в реальном времени.
- `journalctl -b` — просмотр сообщений журнала с последнего успешного входа в систему.

# udev

**Udev** — это менеджер устройств, который автоматически управляет файлами устройств в каталоге `/dev` при подключении или отключении оборудования. Udev позволяет создавать правила для автоматического назначения имен устройствам, установки прав доступа и выполнения других действий при обнаружении нового устройства.

Пример правила udev:

```
ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="1234", ATTR{idProduct}=="5678", SYMLINK+="mydevice"
```

Это правило создаст символьную ссылку `/dev/mydevice` для USB-устройства с идентификатором производителя `1234` и идентификатором продукта `5678`.

# logind

**Logind** отвечает за управление пользовательскими сессиями и сидениями. Сидение (seat) объединяет клавиатуру, мышь, монитор и другие устройства ввода-вывода, используемые пользователем. Logind обеспечивает возможность переключения между пользователями без необходимости выхода из системы.

Чтобы узнать активные сессии и сидения, можно использовать команду:

```
loginctl list-seats
```

# networkd

**Networkd** — это сервис для управления сетевыми интерфейсами. Он позволяет настраивать IP-адреса, маршруты, DNS-серверы и другие сетевые параметры. Networkd использует файлы конфигурации в формате `.network` для определения настроек сети.

Пример файла конфигурации .network:

```
[Match]
Name=eth0

[Network]
Address=192.168.1.100/24
Gateway=192.168.1.1
DNS=8.8.8.8
```

Этот файл настроит интерфейс `eth0` с IP-адресом `192.168.1.100`, шлюзом `192.168.1.1` и DNS-сервером `8.8.8.8`.

# resolved

**Resolved** — это сервис для разрешения доменных имен. Он интегрируется с другими сервисами systemd, такими как networkd, и обеспечивает централизованное управление настройками DNS.

Для настройки DNS-серверов можно использовать файл `/etc/systemd/resolved.conf`:

```
[Resolve]
DNS=8.8.8.8 8.8.4.4
Domains=example.com
```

Эти настройки установят Google DNS-серверы и добавят домен `example.com` в список поисковых доменов.